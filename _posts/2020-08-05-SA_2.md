---
layout: post
title:  "[휴리스틱 알고리즘] 시뮬레이티드 어닐링(Simulated Annealing)에 관하여 2탄"
subtitle:   "Optimization"
categories: data
tags: opt
comments: true
---


## 시뮬레이티드 어닐링의 구조

시뮬레이티드 어닐링은 초기화 단계에서 초기온도($T$), 초기해($x\_{0}$), 초기 반복수($L$) 등을 설정 필요. $L$은 고정된 온도 $T$에서 평형상태에 도달까지 필요한 근접 변화(perturbation)의 반복수를 나타내는 파라미터.  
시뮬레이티드 어닐링은 외부루프와 내부루프로 구성되어 있음.  
초기값이 결정되면 온도 $T$에서 현재해($x$)의 이웃해($x^{\\prime}$)를 생성하여 이웃해의 목적함수 값 $f(x^{\\prime})$이 현재해의 목적함수 값 $f(x)$보다 작으면 이웃해를 현재해로 받아들이고, 그렇지 않으면 **확률로 개선되지 않은 해를 현재해로 받아들인다.**  
이러한 내부루프를 $L$회 반복.  
그 후 외부루프에서 온도 $T$를 낮추고 종료 조건이 만족할 때까지 반복.  
이때 좋지 않은 해를 확률적으로 받아들이면서 지역 최적해를 탈출해 전역 최적해로 나아갈 가능성을 얻게 됨.  
시뮬레이티드 어닐링의 핵심은 수락확률(acceptance probability)과 냉각 스케줄(cooling schedule)의 선택. 수락확률은 개선되지 않은 이웃해로의 이동을 가능하게 하고, 냉각 스케줄은 알고리즘을 반복할때마다 온도 $T$를 적절하게 낮추는 방법을 말함

### 수락기준

**(한줄 정리) 더 좋은 해가 나오면 채택하지만, 확률적으로 가끔은 더 나쁜해도 골라봐.**  
시뮬레이티드 어닐링은 현재해보다 더 좋은 이웃해가 있으면 이동하지만, 현재해보다 더 나쁜 이웃해를 확률적으로 받아들입니다. 나쁜 이웃해를 받아들이는 기준은 메트로폴리스를 사용.  
현재해 $x$와 이웃해 $x^{\\prime}$로 그리고 목적함수 값은 $f(x)$와 $f(x^{\\prime})$로 정의.  
현재해 $x$에서 이웃해 $x^{\\prime}$으로 이동을 $f(x^{\\prime}) \\le f(x)$이거나 $\\exp{(-\\frac{f(x^{\\prime}) - f(x)}{T})} \\ge \\text{random}(0,1)$이면 수락합니다. 따라서 내리막길에서 언덕을 다시 올라가듯이 수락확률로 현재해보다 나쁜 이웃해를 받아들이고 지역해에서 탈출하기 위한 현재해 $x$에서 이웃해 $x^{\\prime}$로 이동은 다음과 같습니다.

$$\\begin{cases}  
f(x^{\\prime}) \\le f(x)\\\\  
\\exp{(-\\frac{f(x^{\\prime}) - f(x)}{T})} \\ge \\text{random}(0,1)  
\\end{cases}$$

목적함수 값 $\\Delta = f(x^{\\prime})-f(x)$가 $0$보다 크거나 같으면 $\\exp(-\\Delta/T)$를 확인하는데, 온도 $T$가 $\\infty$면 이웃해 $x^{\\prime}$를 받아들인 확률이 $1$이고 $T$가 $0$이면 수락 확률이 $0$이 되는 매커니즘.  
최적화 문제에서 목적함수 값을 최소화는 것은 $\\Delta = f(x^{\\prime})-f(x)$이며 최대화는 $\\Delta = f(x)-f(x^{\\prime})$

### 냉각 스케줄

**(한줄 정리) 온도가 처음에는 높았으나 점점 작아지게. $T$가 $0$이면 수락 확률이 $0$이 됨.**  
냉각 스케줄(cooling schedule)은 해의 성능에 큰 영향을 미치는데 적절한 냉각 스케줄을 선택하지 않으면 좋은 해를 구하기 어려움.  
대표적인 냉각 스케줄은 선형(linear) 스케줄, 기하(geometric) 스케줄, 로그(logarithmic) 스케줄 등이 있습니다.  
먼저 냉각 스케줄의 방법을 선택하기 전에 초기 온도를 설정해야 합니다.  
초기에는 온도 $T$가 매우 높기 때문에 수락확률이 높게 설정되어 대부분 이웃해를 받아들입니다.  
초기 온도를 구하는 방법으로는 초기해의 목적함수 값으로 설정하는 방법, 실험을 통해 목적함수 값의 표준편차($\\sigma$)를 이용하는 방법 등이 있습니다.  
냉각 스케줄은 초기 온도$T\_{0}$에서 $k$번째 강하된 $T\_{k}$로 나타냄.

-   선형 스케줄은 시뮬레이티드 어닐링에서 가장 간단한 방법으로 식(1)과 같으며, $\\beta$는 양의 상수입니다.

$$\\begin{equation}  
T\_{k}=T\_{0}-k\\beta  
\\end{equation}$$

-   기하 스케줄은 시뮬레이티드 어닐링에서 온도가 식(2)처럼 낮아집니다. 기하 스케줄은 온도를 내릴 때 온도의 강하율($\\alpha$)를 사용하는데 일반적으로 $0.5$에서 $0.99$ 값이 사용됩니다.

$$\\begin{equation}  
T\_{k}=\\alpha T\_{k-1} \\quad k=1,2,\\dots, ; 0 \\lt \\alpha \\lt 1  
\\end{equation}$$

-   로그 스케줄은 식(3)과 같으며 $c$는 양의 상수입니다.

$$\\begin{equation}  
T\_{k}=\\frac{c}{\\log{(k+1)}}  
\\end{equation}$$

### 내부루프 반복수

**(한줄 정리) 내부루프는 평형 상태까지의 반복횟수.**  
시뮬레이티드 어닐링은 외부루프와 내부루프가 존재함.  
내부루프의 반복수는 주어진 온도에서 평형 상태에 이를 때까지의 반복 횟수를 뜻합니다. 온도 강하 전략과 밀접하게 관련있으며 온도의 하락 폭이 크면 각각의 온도에서 평형 상태의 목적함수 값의 차이가 커지기 때문에 각 온도에서 평형상태를 이루는 반복수가 많아집니다.  
반면 온도의 하락 폭이 작으면 적은 반복에도 쉽게 평형 상태를 이룰 수 있습니다.  
시뮬레이티드 어닐링은 계산소요시간이 길어지면 해의 품질이 향상되는데, 해의 향상을 얻을 때 내부루프의 반복수를 증가시키는 것보다 온도의 하락 폭을 줄이는 것이 좋습니다.  
매 온도에서 평성상태에 도달하는데 요구되는 반복수는 문제의 크기에 따라 지수적으로 증가합니다.  
따라서 적절한 내부루프의 반복수를 결정해야합니다.  
첫째, 일반적인 방법으로 해의 크기에 일정한 상수를 곱하여 내부루프의 반복수가 일정하게 유지되는 정적(static) 방법이 있습니다.  
둘째, 내부루프의 반복수가 상황에 따라 변하는 정응적 방법(adaptive method)로 해의 평균값이 빨리 떨어지는 온도에서는 더 머물게 하는 개념을 사용하는 것입니다.

### 종료 조건

**(한줄 정리) 종료조건은 (1) 온도 $T$를 $0.01$로 설정하거나 (2) 일정 카운터까지 더 좋은 해가 발견되지않으면 종료**  
시뮬레이티드 어닐링의 종료 조건(terminal condition)은 온도가 0에 도달할 때 멈추는 것입니다.  
첫째, 종료 조건의 온도 $T$를 $0.01$로 설정  
둘째, 지금까지 발견한 가장 좋은 해가 개선되지 않으면 종료하는 것 그리고 수락확률이 일정 수준 이하로 떨어진 후에 해의 향상 여부에 따라 종료시점을 결정하는 것입니다.  
온도가 떨어지면 수락확률이 $0$에 수렴되기 때문에 종료 조건의 온도까지 매우 오랜 시간이 걸립니다. 따라서 한계치 아래로 내려가면 카운터를 시작하여 일정한 카운터까지 더 좋은 해가 발견되지 않으면 종료하는 방식입니다.

[참고 블로그](https://unerue.github.io/introduction-simulated-annealing/)